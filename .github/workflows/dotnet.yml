# This workflow will build a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

name: API Integration Workflow

on:
  push:
    branches:
      - main

jobs:
  api-integration:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: '8.0'

    - name: Restore dependencies
      run: dotnet restore

    - name: Build the project
      run: dotnet build --configuration Release

    - name: Call POST API and capture response
      run: |
        echo "Calling POST API"
        $POST_RESPONSE =curl -X POST "https://localhost:7283/api/fhir/patient" -H "Content-Type: application/json" -d "{\"resourceType\":\"Patient\",\"name\":[{\"use\":\"official\",\"family\":\"Doe\",\"given\":[\"John\"]}],\"gender\":\"male\",\"birthDate\":\"1990-01-01\"}" -s -w "%{http_code}" -o post_response.txt
        $POST_STATUS_CODE = (Get-Content post_response.txt | Select-Object -Last 1)
        $POST_RESPONSE_BODY = Get-Content post_response.txt -Raw
        echo "POST Status Code: $POST_STATUS_CODE"
        echo "POST Response Body: $POST_RESPONSE_BODY"
